<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Analytics</title>
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
          crossorigin="anonymous">
          
	 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>          
</head>
<body>
	
	<div id="mySidebar" class="sidebar">
	  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
	  <a href="/item">Items</a>
	  <a href="/order">Orders</a>
	  <a href="/">Employees</a>
	  &nbsp;
	  <a href="/logout" class="red-link">Logout</a>
	</div>
	
	<style>
	/* The sidebar menu */
	
.red-link {
    color: rgb(183, 0, 0) !important;
}	
	
.sidebar {
  height: 100%; /* 100% Full-height */
  width: 0; /* 0 width - change this with JavaScript */
  position: fixed; /* Stay in place */
  z-index: 1; /* Stay on top */
  top: 0;
  left: 0;
  background-color: #111; /* Black*/
  overflow-x: hidden; /* Disable horizontal scroll */
  padding-top: 60px; /* Place content 60px from the top */
  transition: 0.5s; /* 0.5 second transition effect to slide in the sidebar */
}

/* The sidebar links */
.sidebar a {
  padding: 8px 8px 8px 32px;
  text-decoration: none;
  font-size: 20px;
  color: #818181;
  display: block;
  transition: 0.3s;
}

/* When you mouse over the navigation links, change their color */
.sidebar a:hover {
  color: #f1f1f1;
}

/* Position and style the close button (top right corner) */
.sidebar .closebtn {
  position: absolute;
  top: 0;
  right: 25px;
  font-size: 36px;
  margin-left: 50px;
}

/* The button used to open the sidebar */
.openbtn {
  font-size: 16px;
  cursor: pointer;
  background-color: #111;
  color: white;
  padding: 6px 10px;
  border: none;
}

.openbtn:hover {
  background-color: #444;
}

/* Style page content - use this if you want to push the page content to the right when you open the side navigation */
#main {
  transition: margin-left .5s; /* If you want a transition effect */
  padding: 20px;
}

/* On smaller screens, where height is less than 450px, change the style of the sidenav (less padding and a smaller font size) */
@media screen and (max-height: 450px) {
  .sidebar {padding-top: 15px;}
  .sidebar a {font-size: 18px;}
}
</style>
<div id="main">
    <div class="container mt-5">
		<div class="row">
	  <div class="col">
	  	<button class="openbtn" onclick="openNav()">&#9776; Navigation</button>
	  </div>	
      <div class="col-4">
        <h2>Analytics</h2>
      </div>
    </div>
        <!-- ... other content ... -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total Orders</h5>
                        <p class="card-text" th:text="${analyticsData.totalOrders}"></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Total Revenue</h5>
                        <p class="card-text" th:text="${analyticsData.totalRevenue}"></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-4">
    <div class="col-md-12">
        <canvas id="itemSalesChart"></canvas>
    </div>
 </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/analytics-data")
            .then(response => response.json())
            .then(analyticsData => {
                console.log("Analytics Data:", analyticsData);

                // Check if itemSalesData is an array and not empty
                if (Array.isArray(analyticsData.itemSales) && analyticsData.itemSales.length > 0) {
                    var itemSalesData = analyticsData.itemSales;
                    var itemNames = itemSalesData.map(item => item.itemName);
                    var itemQuantities = itemSalesData.map(item => item.quantitySold);

                    // Render the chart only if there is data
                    var ctx = document.getElementById('itemSalesChart').getContext('2d');
                    var itemSalesChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: itemNames,
                            datasets: [{
                                label: 'Quantity Sold',
                                data: itemQuantities,
                                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                } else {
                    // Handle the case where there is no item sales data
                    console.log("No item sales data available");
                }
            })
            .catch(error => {
                console.error("Error fetching analytics data:", error);
            });
    });
    
    function clearSearch() {
        window.location = "[[@{/}]]";
    }
	    /* Set the width of the sidebar to 250px and the left margin of the page content to 250px */
	function openNav() {
	  document.getElementById("mySidebar").style.width = "250px";
	  document.getElementById("main").style.marginLeft = "250px";
	}
	
	/* Set the width of the sidebar to 0 and the left margin of the page content to 0 */
	function closeNav() {
	  document.getElementById("mySidebar").style.width = "0";
	  document.getElementById("main").style.marginLeft = "0";
	}
</script>






</body>
</html>